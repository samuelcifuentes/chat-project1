(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},i=[],s=0;s<e.length;s++){var d=e[s],c=r.base?d[0]+r.base:d[0],u=o[c]||0,l="".concat(c," ").concat(u);o[c]=u+1;var p=n(l),m={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==p)t[p].references++,t[p].updater(m);else{var g=a(m,r);r.byIndex=s,t.splice(s,0,{identifier:l,updater:g,references:1})}i.push(l)}return i}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var o=r(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var s=n(o[i]);t[s].references--}for(var d=r(e,a),c=0;c<o.length;c++){var u=n(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=d}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},208:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(601),a=n.n(r),o=n(314),i=n.n(o)()(a());i.push([e.id,":root {\n    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    color: #0b1f33;\n    background: linear-gradient(135deg, #f5f7fb, #eef2ff);\n    min-height: 100vh;\n}\n\nbody {\n    margin: 0;\n    padding: 2rem;\n}\n\n#app {\n    max-width: 1200px;\n    margin: 0 auto;\n}\n\n.layout {\n    display: grid;\n    grid-template-columns: 320px 1fr;\n    grid-gap: 1.5rem;\n}\n\n.panel {\n    background: #fff;\n    border-radius: 16px;\n    padding: 1.5rem;\n    box-shadow: 0 10px 25px rgba(15, 34, 58, 0.08);\n}\n\n.panel h2 {\n    margin-top: 0;\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n\ninput,\ntextarea,\nselect,\nbutton {\n    width: 100%;\n    padding: 0.75rem 1rem;\n    border-radius: 12px;\n    border: 1px solid #dbe4ff;\n    font-family: inherit;\n    font-size: 0.95rem;\n    box-sizing: border-box;\n    margin-bottom: 0.75rem;\n}\n\nbutton {\n    border: none;\n    background: linear-gradient(135deg, #4f46e5, #7c3aed);\n    color: #fff;\n    font-weight: 600;\n    cursor: pointer;\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n}\n\nbutton:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 15px 30px rgba(76, 29, 149, 0.25);\n}\n\n.status-chip {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.35rem;\n    border-radius: 999px;\n    padding: 0.2rem 0.85rem;\n    font-size: 0.85rem;\n    background: #eef2ff;\n    color: #4338ca;\n    font-weight: 500;\n}\n\n.history {\n    height: 520px;\n    overflow-y: auto;\n    padding-right: 0.5rem;\n}\n\n.message {\n    padding: 0.75rem 1rem;\n    border-radius: 12px;\n    margin-bottom: 0.75rem;\n    background: #f8fafc;\n    border: 1px solid #e2e8f0;\n}\n\n.message.me {\n    background: #ede9fe;\n    border-color: #ddd6fe;\n}\n\n.message header {\n    display: flex;\n    justify-content: space-between;\n    font-size: 0.8rem;\n    margin-bottom: 0.4rem;\n    color: #475569;\n}\n\n.message p {\n    margin: 0;\n}\n\n.target-selector {\n    display: grid;\n    grid-template-columns: repeat(2, minmax(0, 1fr));\n    gap: 0.5rem;\n}\n\n.audio-controls {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.notification {\n    background: #dff5ed;\n    border: 1px solid #a7f3d0;\n    color: #047857;\n    padding: 0.65rem 1rem;\n    border-radius: 12px;\n    margin-bottom: 0.75rem;\n    font-size: 0.9rem;\n}\n\n@media (max-width: 960px) {\n    .layout {\n        grid-template-columns: 1fr;\n    }\n}\n\n",""]);const s=i},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(i[d]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&i[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),a&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=a):u[4]="".concat(a)),t.push(u))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,a&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={id:r,exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var r=n(72),a=n.n(r),o=n(825),i=n.n(o),s=n(659),d=n.n(s),c=n(56),u=n.n(c),l=n(540),p=n.n(l),m=n(113),g=n.n(m),f=n(208),y={};y.styleTagTransform=g(),y.setAttributes=u(),y.insert=d().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=p(),a()(f.A,y),f.A&&f.A.locals&&f.A.locals;const h={communicator:null,adapter:null,chatPrx:null,pushProxy:null,user:null,activeTarget:{id:"",type:"user"},groups:new Map,history:[],recorder:null,audioChunks:[],notifications:[]},v={};async function b(){if(!h.chatPrx)return void L("La conexi贸n con Ice no est谩 lista todav铆a.");const e=v.displayName.value.trim();try{const t=await h.chatPrx.registerUser(e);h.user=t,v.statusChip.textContent=`Conectado como ${t.displayName}`,await async function(){if(!h.user)return;class e extends Chat.RealtimePush{async onIncomingMessage(e){!function(e){const t=T();e.to===t.id&&e.toType===t.type||"user"===e.toType&&e.from===t.id&&"user"===t.type?(h.history.push(e),C()):L(`Nuevo mensaje de ${e.fromName}`)}(e)}async onGroupCreated(e){!function(e){h.groups.set(e.id,e),B(),L(`Se cre贸 el grupo ${e.name}`)}(e)}async onCallEvent(e){!function(e){L("start"===e.type?`${e.fromName} inici贸 una llamada`:`${e.fromName} finaliz贸 la llamada`)}(e)}}const t="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`client-${Date.now()}`,n=Ice.generateUUID?Ice.generateUUID():t,r=Ice.stringToIdentity(n),a=new e;h.adapter.add(a,r);const o=Chat.RealtimePushPrx.uncheckedCast(h.adapter.createProxy(r));await h.chatPrx.subscribePush(h.user.id,o),h.pushProxy=o}(),L(`Bienvenido ${t.displayName}. Tu ID es ${t.id}`)}catch(e){L(`No se pudo registrar: ${e.message}`)}}async function x(){if(!h.user)return void L("Registra un usuario antes de crear grupos.");const e=v.groupName.value.trim()||"Grupo sin nombre",t=v.groupMembers.value.split(",").map(e=>e.trim()).filter(Boolean);try{const n=await h.chatPrx.createGroup(h.user.id,e,t);h.groups.set(n.id,n),B(),L(`Grupo ${n.name} creado (${n.id})`)}catch(e){L(`No se pudo crear el grupo: ${e.message}`)}}function B(){const e=Array.from(h.groups.values());e.length?v.groupList.innerHTML=e.map(e=>`\n            <div class="message">\n                <header>\n                    <strong>${e.name}</strong>\n                    <small>${e.id}</small>\n                </header>\n                <p>${e.members.length} miembros</p>\n                <button data-group="${e.id}">Abrir chat</button>\n            </div>\n        `).join(""):v.groupList.innerHTML="<p>No hay grupos a煤n.</p>"}async function I(){if(E())try{const{id:e,type:t}=T(),n=await h.chatPrx.getHistory(h.user.id,e,t);h.history=n,C()}catch(e){L(`Error al recuperar historial: ${e.message}`)}}function C(){h.history.length?(v.history.innerHTML=h.history.map(e=>function(e){const t=h.user&&e.from===h.user.id,n=new Date(Number(e.timestamp)).toLocaleTimeString();let r="";return"text"===e.kind?r=`<p>${e.text}</p>`:"audio"===e.kind&&(r=`<audio controls src="${e.mediaPath}"></audio>`),`\n        <div class="message ${t?"me":""}">\n            <header>\n                <span>${e.fromName}</span>\n                <span>${n}</span>\n            </header>\n            ${r}\n        </div>\n    `}(e)).join(""),v.history.scrollTop=v.history.scrollHeight):v.history.innerHTML="<p>No hay mensajes todav铆a.</p>"}async function w(){if(!E())return;const e=v.messageInput.value.trim();if(e)try{const{id:t,type:n}=T();await h.chatPrx.sendText(h.user.id,t,n,e),v.messageInput.value=""}catch(e){L(`No se pudo enviar: ${e.message}`)}}function E(){if(!h.user)return L("Primero registra un usuario."),!1;const e=v.targetId.value.trim(),t=v.targetType.value;return e?(h.activeTarget={id:e,type:t},!0):(L("Selecciona un destino."),!1)}function T(){return{id:v.targetId.value.trim(),type:v.targetType.value}}async function N(){if(E())if(navigator.mediaDevices)try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});h.recorder=new MediaRecorder(e),h.audioChunks=[],h.recorder.ondataavailable=e=>{e.data.size>0&&h.audioChunks.push(e.data)},h.recorder.onstop=P,h.recorder.start(),v.recordBtn.disabled=!0,v.stopRecordBtn.disabled=!1,L("Grabando audio...")}catch(e){L(`No se pudo acceder al micr贸fono: ${e.message}`)}else L("El navegador no soporta MediaRecorder.")}function $(){h.recorder&&(h.recorder.stop(),v.recordBtn.disabled=!1,v.stopRecordBtn.disabled=!0,L("Grabaci贸n detenida, enviando..."))}async function P(){const e=new Blob(h.audioChunks,{type:"audio/webm"}),t=await e.arrayBuffer(),{id:n,type:r}=T();try{await h.chatPrx.sendAudio(h.user.id,n,r,new Uint8Array(t),e.type||"audio/webm")}catch(e){L(`Error enviando audio: ${e.message}`)}}async function k(e){if(!E())return;const{id:t,type:n}=T();try{"start"===e?(await h.chatPrx.startCall(h.user.id,t,n),v.startCallBtn.disabled=!0,v.endCallBtn.disabled=!1):(await h.chatPrx.endCall(h.user.id,t,n),v.startCallBtn.disabled=!1,v.endCallBtn.disabled=!0)}catch(e){L(`Error con la llamada: ${e.message}`)}}function L(e,t){const n=document.createElement("div");n.className="notification",n.textContent=e,v.notifications.prepend(n),setTimeout(()=>n.remove(),6e3)}document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("app").innerHTML='\n        <div class="layout">\n            <div class="panel" id="sessionPanel">\n                <h2>Sesi贸n</h2>\n                <span id="statusChip" class="status-chip">Desconectado</span>\n                <input id="displayName" type="text" placeholder="Nombre visible" />\n                <button id="registerBtn">Registrar usuario</button>\n                <hr />\n                <h2>Grupo</h2>\n                <input id="groupName" type="text" placeholder="Nombre del grupo" />\n                <input id="groupMembers" type="text" placeholder="Miembros (IDs separados por coma)" />\n                <button id="createGroupBtn">Crear grupo</button>\n                <div id="groupList"></div>\n            </div>\n            <div class="panel">\n                <h2>Chat en tiempo real</h2>\n                <div id="notifications"></div>\n                <div class="target-selector">\n                    <select id="targetType">\n                        <option value="user">Usuario</option>\n                        <option value="group">Grupo</option>\n                    </select>\n                    <input id="targetId" type="text" placeholder="ID de destino" />\n                </div>\n                <button id="loadHistoryBtn">Ver historial</button>\n                <div class="history" id="history"></div>\n                <textarea id="messageInput" rows="3" placeholder="Escribe un mensaje..."></textarea>\n                <button id="sendTextBtn">Enviar texto</button>\n                <div class="audio-controls">\n                    <button id="recordBtn"> Grabar</button>\n                    <button id="stopRecordBtn" disabled>Detener</button>\n                </div>\n                <div class="audio-controls">\n                    <button id="startCallBtn">Iniciar llamada</button>\n                    <button id="endCallBtn" disabled>Finalizar llamada</button>\n                </div>\n            </div>\n        </div>\n    ',v.displayName=document.getElementById("displayName"),v.registerBtn=document.getElementById("registerBtn"),v.statusChip=document.getElementById("statusChip"),v.groupName=document.getElementById("groupName"),v.groupMembers=document.getElementById("groupMembers"),v.createGroupBtn=document.getElementById("createGroupBtn"),v.groupList=document.getElementById("groupList"),v.targetType=document.getElementById("targetType"),v.targetId=document.getElementById("targetId"),v.loadHistoryBtn=document.getElementById("loadHistoryBtn"),v.history=document.getElementById("history"),v.messageInput=document.getElementById("messageInput"),v.sendTextBtn=document.getElementById("sendTextBtn"),v.recordBtn=document.getElementById("recordBtn"),v.stopRecordBtn=document.getElementById("stopRecordBtn"),v.startCallBtn=document.getElementById("startCallBtn"),v.endCallBtn=document.getElementById("endCallBtn"),v.notifications=document.getElementById("notifications"),v.registerBtn.addEventListener("click",b),v.createGroupBtn.addEventListener("click",x),v.groupList.addEventListener("click",e=>{const t=e.target.closest("button[data-group]");var n,r;t&&(n=t.dataset.group,r="group",h.activeTarget={id:n,type:r},v.targetId.value=n,v.targetType.value=r,L(`Objetivo activo: ${n} (${r})`),I())}),v.loadHistoryBtn.addEventListener("click",I),v.sendTextBtn.addEventListener("click",w),v.recordBtn.addEventListener("click",N),v.stopRecordBtn.addEventListener("click",$),v.startCallBtn.addEventListener("click",()=>k("start")),v.endCallBtn.addEventListener("click",()=>k("end")),await async function(){if(!window.Ice)return void L("No se pudo cargar Ice.js desde la CDN.");if(!window.Chat)return void L("Genera el archivo ice/Chat.js con slice2js antes de continuar.");h.communicator=Ice.initialize(["Ice.ACM.Client=0","Ice.Trace.Network=0","Ice.RetryIntervals=-1","Ice.Default.Protocol=ws"]);const e=h.communicator.stringToProxy("ChatSession:ws -h localhost -p 10000");h.chatPrx=await Chat.ChatSessionPrx.checkedCast(e),h.adapter=h.communicator.createObjectAdapter(""),await h.adapter.activate(),v.statusChip.textContent="Ice listo"}()})})();